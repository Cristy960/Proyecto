@model IEnumerable<Proyecto.Models.Requerimiento>

@{
    ViewBag.Title = "Index";
}






<script src = "~/Scripts/jquery-1.10.2.js" > </script> 
<script>
    $(document).ready(function() {
        $("#nombreModulo").prop("disabled", true);

        $("#nombreProyecto").change(function () {

            if ($("#nombreProyecto").val() != "Seleccione un Proyecto") {

                var ModulosProyecto = {};

                ModulosProyecto.url = "Requerimientos/getModulos";
                ModulosProyecto.type = "POST";
                ModulosProyecto.data = JSON.stringify({
                    nombreProyecto: $("#nombreProyecto").val()
                });
                ModulosProyecto.datatype = "json";
                ModulosProyecto.contentType = "application/json";
                ModulosProyecto.success = function(data) {

                    $("#nombreModulo").empty();
                    for (var i = 0; i < data.length; i++) {
                        $("#nombreModulo").append("<option>" + data[i] + "</option>");
                    }
                    $("#nombreModulo").prop("disabled", false);
                };

                ModulosProyecto.error = function () {
                    alert("Error obteniendo los modulos");
                };

                $.ajax(ModulosProyecto);
            } else {
                $("#nombreModulo").empty();
                $("#nombreModulo").prop("disabled", true);
            }
        });
    }); 
</script>





<body onload="Desabilitar();">
    <p>
        @Html.ActionLink("Create New", "Create")
    </p>
    


    @*
        @using (Html.BeginForm("Index", "Requerimiento", FormMethod.Post))
        {

            @Html.AntiForgeryToken()
            <h4> Select Country & States</h4> <hr /> @Html.ValidationSummary()
            @Html.AntiForgeryToken() <h4> Select Country & States </h4> <hr/> @Html.ValidationSummary() <div class = "form-group" > @Html.Label("Select Country:", new { @class = "col-md-2 control-label" })
        <div class = "col-md-10"> @Html.DropDownList("nombreProyecto", ((Proyecto.Controllers.RequerimientoController)this.ViewContext.Controller).getProyectos("Cliente", (string)System.Web.HttpContext.Current.Session["cedula"]), new { @class = "form-control" })
            </div> </div><br/> <div class = "form-group"> @Html.Label("Select States:", new { @class = "col-md-2 control-label" })
        <div class = "col-md-10"> <select id = "Modulo" > </select> </div> </div>
        <div class = "form-group" > <div class = "col-md-offset-2 col-md-10" > <input type = "submit" class = "btn btn-default" value = "Buscar" /> </div> </div>
        }
    *@











    
        <fieldset>
            <div class="display-label">
                Filtrar por Proyecto
            </div>
            <div class="editor-field">
                @if ((string)System.Web.HttpContext.Current.Session["rol"] == "Cliente")
                {
                    @Html.DropDownList("nombreProyecto", ((Proyecto.Controllers.RequerimientoController)this.ViewContext.Controller).getProyectos("Cliente", (string)System.Web.HttpContext.Current.Session["cedula"]), "Seleccione un Proyecto")
                }
                else if ((string)System.Web.HttpContext.Current.Session["rol"] == "Jefe")
                {
                    @Html.DropDownList("nombreProyecto", ((Proyecto.Controllers.RequerimientoController)this.ViewContext.Controller).getProyectos("Jefe", (string)System.Web.HttpContext.Current.Session["cedula"]), "Seleccione un Proyecto")
                }
                else
                {
                    @Html.DropDownList("nombreProyecto", ((Proyecto.Controllers.RequerimientoController)this.ViewContext.Controller).getProyectos("Empleado", (string)System.Web.HttpContext.Current.Session["cedula"]), "Seleccione un Proyecto")
                }
                <div class = "col-md-10"> <select id = "nombreModulo"> </select> </div>

                @*@Html.DropDownList("nombreModulo",null, String.Empty, "Seleccione Modulo" )*@
            </div>
            <p>
                <input type="submit" value="Buscar" class="btn btn-default" />
            </p>
        </fieldset>

                }


<p class=" boton float-right">
    <button onclick="location.href = 'Requerimiento/Create'" class="btn btn-success Lider Desarrollador Cliente btn-lg glyphicon glyphicon-plus float-right "></button>
</p>



<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.nombre)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.complejidad)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.estado)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.cedulaResponsable_FK)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Modulo.Nombre)
        </th>
        <th></th>
    </tr>

    @foreach (var item in Model)
    {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.nombre)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.complejidad)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.estado)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.cedulaResponsable_FK)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Modulo.Nombre)
            </td>
            <td>
                @Html.ActionLink(" ", "Edit", "Requerimiento", new { /*id = item.nombre, modulo = item.idModulo_FK, nombreProy = item.nombreProyecto_FK*/ }, new { @class = "btn  Cliente btn-info glyphicon glyphicon-wrench float-right " })

                @Html.ActionLink(" ", "Delete", "Requerimiento", new { /*id = item.nombre, modulo = item.idModulo_FK, nombreProy = item.nombreProyecto_FK*/ }, new { @class = "btn Desarrollador Cliente btn-danger glyphicon glyphicon-trash float-right " })
            </td>
        </tr>
    }

</table>

<script>
        function Desabilitar() {
            var rol = '@ViewBag.user';
            var lista = document.getElementsByClassName(rol);
            for (var i = 0; i < lista.length; ++i) {
                lista[i].hidden = true;
            }
        }
</script>
</body>